<div class="profile-container">
    <header class="header">
        <h1>Meu Perfil</h1>
    </header>

    <div class="scroll-content">
        <section class="section photos-section">
            <div class="section-header">
                <h2>Suas Fotos</h2>
                <span class="counter">{{ photoCount }}/8</span>
            </div>

            <div class="photo-grid">
                <div class="photo-slot-wrapper" *ngFor="let photo of photos; let i = index">
                    <span class="cover-label" *ngIf="i === 0">
                        <div class="info-wrapper">
                            <i class="fas fa-info-circle info-icon"
                                (click)="$event.stopPropagation(); toggleCoverInfo()"></i>
                            Capa
                            <span class="required" *ngIf="!validatePhotos">*</span>

                            <div class="tooltip-balloon" *ngIf="showCoverInfo" (click)="$event.stopPropagation()">
                                <p>Essa é a foto que aparecerá como capa do seu perfil.</p>
                                <div class="arrow-down"></div>
                            </div>
                        </div>
                    </span>
                    <div class="photo-slot" (click)="onPhotoClick(i)" [class.mandatory]="i === 0">
                        <img *ngIf="photo" [src]="photo" alt="Photo {{i+1}}">
                        <span *ngIf="!photo" class="plus-icon">+</span>

                        <button *ngIf="photo" class="remove-btn" (click)="removePhoto(i, $event)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
            <p class="hint">Adicione até 8 fotos para mostrar quem você é</p>
        </section>

        <section class="section info-section">
            <h2>Informações Básicas</h2>

            <div class="form-group">
                <label>Nome <span class="required" *ngIf="!profile.displayName">*</span></label>
                <input type="text" [(ngModel)]="profile.displayName" (input)="onNameInput($event)">
            </div>

            <div class="row">
                <div class="form-group col">
                    <label>Idade <span class="required" *ngIf="showAgeAsterisk">*</span></label>
                    <div class="age-input-group">
                        <input type="text" inputmode="numeric" required [ngModel]="profile.age"
                            (keydown)="blockNonNumeric($event)" (input)="onAgeInput($event)">

                        <small *ngIf="ageInvalid">
                            Idade minima: 18 anos
                        </small>
                    </div>
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="hideAge" [(ngModel)]="profile.hideAge">
                        <label for="hideAge">Esconder Idade</label>
                        <i class="fas fa-info-circle info-icon" (click)="$event.stopPropagation(); toggleAgeInfo()"></i>

                        <div class="tooltip-balloon" *ngIf="showAgeInfo" (click)="$event.stopPropagation()">
                            <p>Ao selecionar esta opção, sua idade não será exibida no feed.
                                <br>
                                Mas ainda precisamos dela para fazer regras de exibição.
                            </p>
                            <div class="arrow-down"></div>
                        </div>
                    </div>
                </div>
                <div class="form-group col">
                    <label>Estado <span class="required" *ngIf="!profile.state">*</span></label>
                    <input style="text-transform: uppercase;" type="text" maxlength="2" (input)="onlyLetters($event)"
                        [(ngModel)]="profile.state">
                </div>
            </div>

            <div class="form-group">
                <label>Cidade <span class="required" *ngIf="!profile.city">*</span></label>
                <input type="text" [(ngModel)]="profile.city">
            </div>
        </section>

        <section class="section info-section">
            <h2>Conte mais sobre você <span class="required" *ngIf="!profile.bio">*</span></h2>

            <div class="form-group description-wrapper">
                <textarea class="description-input" [(ngModel)]="profile.bio"
                    placeholder="Descrição que aparecerá no seu perfil"></textarea>
            </div>
        </section>


        <section class="section gender-section">
            <h2>Gênero <span class="required" *ngIf="!profile.gender">*</span></h2>
            <p class="subtitle">Como você se identifica?</p>

            <div class="radio-group">
                <label class="radio-option">
                    <input type="radio" name="gender" [(ngModel)]="profile.gender" value="Homem">
                    <span class="radio-label">Homem</span>
                    <span class="custom-radio"></span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="gender" [(ngModel)]="profile.gender" value="Mulher">
                    <span class="radio-label">Mulher</span>
                    <span class="custom-radio"></span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="gender" [(ngModel)]="profile.gender" value="Não-binário">
                    <span class="radio-label">Não-binário</span>
                    <span class="custom-radio"></span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="gender" [(ngModel)]="profile.gender" value="Outros">
                    <span class="radio-label">Outros / Prefiro não dizer</span>
                    <span class="custom-radio"></span>
                </label>
            </div>
        </section>

        <section class="section interest-in-section">
            <h2>Preferências <span class="required" *ngIf="!profile.interestedIn">*</span></h2>
            <p class="subtitle">Quem você está procurando?</p>
            <div class="radio-group">
                <label class="radio-option">
                    <input type="radio" name="interestedIn" [(ngModel)]="profile.interestedIn" value="Homem">
                    <span class="radio-label">Homem</span>
                    <span class="custom-radio"></span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="interestedIn" [(ngModel)]="profile.interestedIn" value="Mulher">
                    <span class="radio-label">Mulher</span>
                    <span class="custom-radio"></span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="interestedIn" [(ngModel)]="profile.interestedIn" value="Todos">
                    <span class="radio-label">Todos / Não-binário</span>
                    <span class="custom-radio"></span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="interestedIn" [(ngModel)]="profile.interestedIn" value="Qualquer">
                    <span class="radio-label">Qualquer gênero</span>
                    <span class="custom-radio"></span>
                </label>
            </div>
            <br>
            <p class="subtitle">Faixa etária que você deseja ver</p>

            <div class="form-group">
                <label>Faixa de Idade <span class="required" *ngIf="showAgeRangeAsterisk">*</span></label>
                <div class="row">
                    <div class="col">
                        <input type="text" inputmode="numeric" [ngModel]="profile.ageRange.min"
                            (input)="onAgeRangeInput($event, 'min')" placeholder="Min" [disabled]="profile.seeAllAges">
                    </div>
                    <div class="col">
                        <input type="text" inputmode="numeric" [ngModel]="profile.ageRange.max"
                            (input)="onAgeRangeInput($event, 'max')" placeholder="Max" [disabled]="profile.seeAllAges">
                    </div>
                </div>
                <small *ngIf="isAgeRangeInvalid">
                    A idade mínima: 18 anos.
                </small>
            </div>

            <div class="checkbox-wrapper">
                <input type="checkbox" id="seeAllAges" [(ngModel)]="profile.seeAllAges" (change)="onSeeAllAgesChange()">
                <label for="seeAllAges">Ver todas as idades</label>
            </div>
        </section>

        <section class="section tags-section">
            <h2>Seus Interesses</h2>
            <p class="subtitle">Adicione tags que representam você</p>

            <div class="selected-tags">
                <span class="tag selected" *ngFor="let tag of profile.hobbies">
                    {{ tag }} <i class="fas fa-times" (click)="removeHobby(tag)"></i>
                </span>
            </div>

            <div class="input-group-append">
                <input type="text" maxlength="15" [(ngModel)]="newHobby" (keydown.enter)="addHobby()"
                    placeholder="Adicionar interesse...">
                <button class="add-btn" (click)="addHobby()">+</button>
            </div>

            <p class="hint">Mais usados</p>
            <div class="suggested-tags">
                <button class="tag suggestion" *ngFor="let tag of suggestedInterests" (click)="addHobby(tag)">
                    {{ tag }}
                </button>
            </div>
        </section>

        <div class="footer-action">
            <button class="save-full-btn" [disabled]="!isFormValid || !isDirty" (click)="saveProfile()">Salvar
                Perfil</button>
            <button class="logout-btn" (click)="logout()">Sair</button>
            <button class="help-btn" (click)="openHelpModal()">Dúvidas, problemas ou sugestões?</button>
        </div>

        <input type="file" #fileInput (change)="onFileSelected($event)" accept="image/*" style="display: none;">

        <div style="height: 80px;"></div>
    </div>

    <div class="modal-overlay" *ngIf="showLogoutModal">
        <div class="modal-content">
            <h3>Deseja realmente sair?</h3>
            <div class="modal-actions">
                <button class="btn-cancel" (click)="cancelLogout()">Não</button>
                <button class="btn-confirm" (click)="confirmLogout()">Sim</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal-overlay" *ngIf="showHelpModal">
        <div class="modal-content help-modal">
            <h3>Atendimento</h3>

            <div class="form-group">
                <label>O que você precisa?</label>
                <select [(ngModel)]="helpType">
                    <option value="duvida">Dúvida</option>
                    <option value="problema">Problema</option>
                    <option value="sugestao">Sugestão</option>
                </select>
            </div>

            <div class="form-group">
                <label>Sua mensagem</label>
                <textarea rows="4" [(ngModel)]="helpMessage" placeholder="Descreva aqui..."></textarea>
            </div>

            <div class="modal-actions">
                <button class="btn-cancel" (click)="closeHelpModal()">Cancelar</button>
                <button class="btn-confirm" (click)="sendHelp()" [disabled]="!helpMessage.trim()">Enviar</button>
            </div>
        </div>
    </div>

    <!-- Loader Test Button & Component -->
    <!-- <button (click)="toggleLoader()"
        style="position: fixed; bottom: 20px; right: 20px; z-index: 10000; padding: 10px 20px; background: #9c27b0; color: white; border: none; border-radius: 20px; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer;">
        Testar Loader
    </button> -->
    <div *ngIf="showLoader" (click)="toggleLoader()"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10001; cursor: pointer;">
        <app-loader></app-loader>
    </div>