<div class="profile-container">
    <header class="header">
        <h1>Meu Perfil</h1>
    </header>

    <div class="scroll-content">
        <!-- Photos Section -->
        <section class="section photos-section">
            <div class="section-header">
                <h2>Suas Fotos <span class="required" *ngIf="!validatePhotos">*</span>
                </h2>
                <span class="counter">0/8</span>
            </div>

            <div class="photo-grid">
                <div class="photo-slot" *ngFor="let photo of photos; let i = index" (click)="onPhotoClick(i)"
                    [class.mandatory]="i === 0">
                    <img *ngIf="photo" [src]="photo" alt="Photo {{i+1}}">
                    <span *ngIf="!photo" class="plus-icon">+</span>

                    <button *ngIf="photo" class="remove-btn" (click)="removePhoto(i, $event)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <p class="hint">Adicione até 8 fotos para mostrar quem você é</p>
        </section>

        <!-- Basic Info Section -->
        <section class="section info-section">
            <h2>Informações Básicas</h2>

            <div class="form-group">
                <label>Nome <span class="required" *ngIf="!profile.name">*</span></label>
                <input type="text" [(ngModel)]="profile.name" (input)="onNameInput($event)">
            </div>

            <div class="row">
                <div class="form-group col">
                    <label>Idade <span class="required" *ngIf="showAgeAsterisk">*</span></label>
                    <div class="age-input-group">
                        <input type="text" inputmode="numeric" required [ngModel]="profile.age"
                            (ngModelChange)="profile.age = $event" (keydown)="blockNonNumeric($event)"
                            (input)="onAgeInput($event)">

                        <small *ngIf="ageInvalid">
                            Idade minima: 18 anos
                        </small>
                    </div>
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="hideAge" [(ngModel)]="profile.hideAge">
                        <label for="hideAge">Esconder Idade</label>
                        <i class="fas fa-info-circle info-icon" (click)="$event.stopPropagation(); toggleAgeInfo()"></i>

                        <div class="tooltip-balloon" *ngIf="showAgeInfo" (click)="$event.stopPropagation()">
                            <p>Ao selecionar esta opção, sua idade não será exibida no feed.
                                <br>
                                Mas ainda precisamos dela para fazer regras de filtro.
                            </p>
                            <div class="arrow-down"></div>
                        </div>
                    </div>
                </div>
                <div class="form-group col">
                    <label>Estado <span class="required" *ngIf="!profile.state">*</span></label>
                    <input style="text-transform: uppercase;" type="text" maxlength="2" (input)="onlyLetters($event)"
                        [(ngModel)]="profile.state">
                </div>
            </div>

            <div class="form-group">
                <label>Cidade <span class="required" *ngIf="!profile.city">*</span></label>
                <input type="text" [(ngModel)]="profile.city">
            </div>
        </section>

        <section class="section info-section">
            <h2>Conte mais sobre você <span class="required" *ngIf="!profile.description">*</span></h2>

            <div class="form-group description-wrapper">
                <textarea class="description-input" [(ngModel)]="profile.description"
                    placeholder="Descrição que aparecerá no seu perfil"></textarea>
            </div>
        </section>


        <!-- Gender Section -->
        <section class="section gender-section">
            <h2>Gênero <span class="required" *ngIf="!profile.gender">*</span></h2>
            <p class="subtitle">Como você se identifica?</p>

            <div class="radio-group">
                <label class="radio-option">
                    <input type="radio" name="gender" [(ngModel)]="profile.gender" value="Homem">
                    <span class="radio-label">Homem</span>
                    <span class="custom-radio"></span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="gender" [(ngModel)]="profile.gender" value="Mulher">
                    <span class="radio-label">Mulher</span>
                    <span class="custom-radio"></span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="gender" [(ngModel)]="profile.gender" value="Não-binário">
                    <span class="radio-label">Não-binário</span>
                    <span class="custom-radio"></span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="gender" [(ngModel)]="profile.gender" value="Outros">
                    <span class="radio-label">Outros / Prefiro não dizer</span>
                    <span class="custom-radio"></span>
                </label>
            </div>
        </section>

        <!-- Interested In Section -->
        <section class="section interest-in-section">
            <h2>Preferências <span class="required" *ngIf="!profile.interestedIn">*</span></h2>
            <p class="subtitle">Quem você está procurando?</p>
            <div class="radio-group">
                <label class="radio-option">
                    <input type="radio" name="interestedIn" [(ngModel)]="profile.interestedIn" value="Homem">
                    <span class="radio-label">Homem</span>
                    <span class="custom-radio"></span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="interestedIn" [(ngModel)]="profile.interestedIn" value="Mulher">
                    <span class="radio-label">Mulher</span>
                    <span class="custom-radio"></span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="interestedIn" [(ngModel)]="profile.interestedIn" value="Todos">
                    <span class="radio-label">Todos / Não-binário</span>
                    <span class="custom-radio"></span>
                </label>
                <label class="radio-option">
                    <input type="radio" name="interestedIn" [(ngModel)]="profile.interestedIn" value="Qualquer">
                    <span class="radio-label">Qualquer gênero</span>
                    <span class="custom-radio"></span>
                </label>
            </div>
            <br>
            <p class="subtitle">Faixa etária que você deseja ver</p>

            <div class="form-group">
                <label>Faixa de Idade <span class="required" *ngIf="showAgeRangeAsterisk">*</span></label>
                <div class="row">
                    <div class="col">
                        <input type="text" inputmode="numeric" [ngModel]="profile.ageRange.min"
                            (input)="onAgeRangeInput($event, 'min')" placeholder="Min" [disabled]="profile.seeAllAges">
                    </div>
                    <div class="col">
                        <input type="text" inputmode="numeric" [ngModel]="profile.ageRange.max"
                            (input)="onAgeRangeInput($event, 'max')" placeholder="Max" [disabled]="profile.seeAllAges">
                    </div>
                </div>
                <small *ngIf="isAgeRangeInvalid">
                    A idade mínima: 18 anos.
                </small>
            </div>

            <div class="checkbox-wrapper">
                <input type="checkbox" id="seeAllAges" [(ngModel)]="profile.seeAllAges" (change)="onSeeAllAgesChange()">
                <label for="seeAllAges">Ver todas as idades</label>
            </div>
        </section>

        <!-- Interests Tags Section -->
        <section class="section tags-section">
            <h2>Seus Interesses</h2>
            <p class="subtitle">Adicione tags que representam você</p>

            <div class="selected-tags">
                <span class="tag selected" *ngFor="let tag of profile.interests">
                    {{ tag }} <i class="fas fa-times" (click)="removeInterest(tag)"></i>
                </span>
            </div>

            <div class="input-group-append">
                <input type="text" maxlength="15" [(ngModel)]="newInterest" (keydown.enter)="addInterest()"
                    placeholder="Adicionar interesse...">
                <button class="add-btn" (click)="addInterest()">+</button>
            </div>

            <p class="hint">Mais usados</p>
            <div class="suggested-tags">
                <button class="tag suggestion" *ngFor="let tag of availableInterests" (click)="addInterest(tag)">
                    {{ tag }}
                </button>
            </div>
        </section>

        <div class="footer-action">
            <button class="save-full-btn" [disabled]="!isFormValid || !isDirty" (click)="saveProfile()">Salvar
                Perfil</button>
            <button class="logout-btn" (click)="logout()">Sair</button>
        </div>

        <input type="file" #fileInput (change)="onFileSelected($event)" accept="image/*" style="display: none;">

        <div style="height: 80px;"></div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div class="modal-overlay" *ngIf="showLogoutModal">
        <div class="modal-content">
            <h3>Deseja realmente sair?</h3>
            <div class="modal-actions">
                <button class="btn-cancel" (click)="cancelLogout()">Não</button>
                <button class="btn-confirm" (click)="confirmLogout()">Sim</button>
            </div>
        </div>
    </div>
</div>